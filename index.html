<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Prácticas Docentes</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SheetJS (Excel) -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    
    <!-- Babel Standalone (para compilar React en el navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Configuración Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        corporate: {
                            blue: '#26B2DD', // Azul Acento
                            dark: '#3A445D', // Azul Oscuro
                        }
                    },
                    fontFamily: {
                        sans: ['Roboto', 'Open Sans', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Scrollbar personalizado */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        body { background-color: #ffffff; }
        
        /* Animación de carga */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-custom {
            animation: spin 1s linear infinite;
        }
    </style>

    <!-- Import Map para React y Lucide -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react/": "https://aistudiocdn.com/react@^19.2.1/"
  }
}
</script>
</head>
<body class="text-slate-800 antialiased h-screen overflow-hidden flex flex-col">
    
    <div id="root" class="flex-1 flex flex-col h-full"></div>

    <!-- LÓGICA DE LA APLICACIÓN -->
    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useRef, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            GraduationCap, User, AlertCircle, Search, MapPin, Hash, 
            School, Plus, Trash2, ArrowUp, ArrowDown, FileDown, CheckCircle, Loader2, UploadCloud, ChevronDown
        } from 'lucide-react';

        // --- CONFIGURACIÓN BACKEND ---
        // URL de tu Script de Google Apps desplegado
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxqCRFYzk6WvUcRZsm_3al9zmNOGawN1eg7G_RK5YV-Ukq808GVIOadsrlMHtgeLVTl1w/exec"; 

        // --- DATOS MOCK ---
        const TEACHER_LIST = [
          "Aboín Martín, Gregorio",
          "Acosta Sznajderman, Leticia Sol",
          "Alcaraz Montesinos, Amparo",
          "Almira González, Rebeca",
          "Álvarez Rodríguez, Margarita",
          "Arechavaleta Viñuales, Marta",
          "Asenjo Gómez, Félix",
          "Baídez García, Pablo",
          "Campo Sánchez, Carlos",
          "Cano Reguero, Sylvia",
          "Carballo Leyda, Irma Susana",
          "Castañeda López, Esther",
          "Ceniceros Estévez, Juan Carlos",
          "Chamorro Mordillo, Carlos",
          "Torre Serrano, Carmen de la",
          "Fernández Angosto, Ana",
          "Fernández Trashorras, Francisco Jesús",
          "Ferrer García, Rodrigo",
          "Fuentes García, Paloma",
          "Giménez Lozano, José Miguel",
          "González García, Elvira",
          "Hidalgo Penadés, Jordi",
          "Huerga Pérez, Carlos",
          "Jara Casas, Zoraida",
          "López Moreno, Ismael",
          "Lucena Ferrero, Ricardo",
          "Machuca Garrido, Mª Virtudes",
          "Mansilla Morales, José Manuel",
          "Marcos Cuesta, Mª Ángeles",
          "Martín Sánchez, Antonia",
          "Martín Talavera, Jorge",
          "Martínez García, Cristina Mª",
          "Martínez Tortosa, Antonio",
          "Mateu Rubert, Miguel",
          "Mayor Guerra, Andrea",
          "Míguez Iglesias, Alberto",
          "Miranda García, Ana",
          "Monterreal Gil, Óscar",
          "Mora Ruano, David",
          "Muñoz Clemente, Carolina",
          "Navarro Molina, Pilar",
          "Neuman Galán, Diego",
          "Ortega Bofill, María",
          "Pérez Orozco, María",
          "Rey Pastor, Marcos",
          "Rodríguez Gil, Mª Elena",
          "Ruiz Dávila, María",
          "Saiz Ruiz, Cristina",
          "Sánchez Fernández, Paula",
          "Sánchez-Valiente Riesco, Virginia",
          "Sevillano Huete, Ainoa",
          "Squire, Valérie",
          "Temes Zafrilla, Elisa",
          "Torre Puente, Juan Carlos",
          "Villar Sanjurjo, Susana"
        ].sort();

        const MOCK_CENTERS = [
            { id: '28032195', status: 'Disponible 25-26', code: '28032195', name: 'CPR INF-PRI CENIT', zone: 'Madrid-Ciudad Lineal', students: 4 },
            { id: '28030711', status: 'Disponible 25-26', code: '28030711', name: 'CPR EE LA PURISIMA', zone: 'Madrid-Ciudad Lineal', students: 2 },
            { id: '28019725', status: 'Disponible 25-26', code: '28019725', name: 'CPR INF-PRI-SEC SAN RAMON Y SAN ANTONIO', zone: 'Madrid-Chamartín', students: 2 },
            { id: '28016712', status: 'Disponible 25-26', code: '28016712', name: 'CPR INF-PRI-SEC MATER PURISSIMA', zone: 'Madrid-Usera', students: 5 },
            { id: '28076319', status: 'Disponible 25-26', code: '28076319', name: 'CP EE SANTIAGO RAMON Y CAJAL', zone: 'Getafe', students: 3 },
            { id: '28012354', status: 'Disponible 25-27', code: '28012354', name: 'CPR INF-PRI-SEC JESUS MARIA', zone: 'Madrid-Salamanca', students: 11 },
            { id: '28032225', status: 'Disponible 25-28', code: '28032225', name: 'CPR INF-PRI JESUS MARIA-NUESTRA SEÑORA CARIDAD DEL COBRE', zone: 'Madrid-San Blas-Canillejas', students: 10 },
            { id: '28044501', status: 'Disponible 25-30', code: '28044501', name: 'CEPA VISTA ALEGRE', zone: 'Madrid-Carabanchel', students: 3 },
            { id: '28019439', status: 'Disponible 25-31', code: '28019439', name: 'CP INF-PRI CIUDAD DE BADAJOZ', zone: 'Madrid-Latina', students: 1 },
            { id: '28024198', status: 'Disponible 25-32', code: '28024198', name: 'CPR INF-PRI-SEC CRISTO REY', zone: 'Rozas de Madrid, Las', students: 3 },
            { id: '28025166', status: 'Disponible 25-33', code: '28025166', name: 'CPR INF-PRI-SEC SAN IGNACIO DE LOYOLA', zone: 'Torrelodones', students: 3 },
            { id: '28013292', status: 'Otros', code: '28013292', name: 'CPR INF-PRI-SEC MONTSERRAT', zone: 'Madrid-Retiro', students: 5 },
            { id: '28005520', status: 'Otros', code: '28005520', name: 'A. HOSP. HOSPITAL DEL NIÑO JESUS', zone: 'Madrid-Retiro', students: 2 },
            { id: '28014867', status: 'Otros', code: '28014867', name: 'CPR INF-PRI-SEC VEDRUNA', zone: 'Madrid-Carabanchel', students: 17 },
            { id: '28008958', status: 'Otros', code: '28008958', name: 'CPR INF-PRI-SEC ENRIQUETA AYMER', zone: 'Madrid-Carabanchel', students: 6 },
            { id: '28020120', status: 'Otros', code: '28020120', name: 'CPR INF-PRI-SEC CHAMBERI', zone: 'Madrid-Chamberí', students: 3 },
            { id: '28007292', status: 'Otros', code: '28007292', name: 'CPR INF-PRI-SEC SAGRADO CORAZON DE JESUS', zone: 'Madrid-Chamberí', students: 2 },
            { id: '28009446', status: 'Otros', code: '28009446', name: 'CPR INF-PRI-SEC SAN VIATOR', zone: 'Madrid-Usera', students: 5 },
            { id: '28006214', status: 'Otros', code: '28006214', name: 'CP INF-PRI LOS ROSALES', zone: 'Madrid-Villaverde', students: 3 },
            { id: '28046881', status: 'Otros', code: '28046881', name: 'CPR INF-PRI-SEC SAN SATURIO', zone: 'Madrid-Centro', students: 10 },
            { id: '28007607', status: 'Otros', code: '28007607', name: 'CPR INF-PRI-SEC JESUS MAESTRO', zone: 'Madrid-Chamberí', students: 4 },
            { id: '28012196', status: 'Otros', code: '28012196', name: 'CPR INF-PRI-SEC LA INMACULADA-MARILLAC', zone: 'Madrid-Chamberí', students: 1 },
            { id: '28013838', status: 'Otros', code: '28013838', name: 'CPR INF-PRI-SEC PARAISO SAGRADOS CORAZONES', zone: 'Madrid-Chamartín', students: 4 },
            { id: '28008946', status: 'Otros', code: '28008946', name: 'CPR INF-PRI-SEC SAGRADOS CORAZONES', zone: 'Madrid-Moncloa-Aravaca', students: 1 },
            { id: '28039086', status: 'Otros', code: '28039086', name: 'CP INF-PRI JULIAN BESTEIRO', zone: 'Getafe', students: 1 },
            { id: '28014910', status: 'Otros', code: '28014910', name: 'CPR INF-PRI-SEC VIRGEN DE ATOCHA', zone: 'Madrid-Retiro', students: 12 },
            { id: '28006172', status: 'Otros', code: '28006172', name: 'CP INF-PRI REPUBLICA DE ECUADOR', zone: 'Madrid-Carabanchel', students: 5 },
            { id: '28005179', status: 'Otros', code: '28005179', name: 'CP INF-PRI CAPITAN CORTES', zone: 'Madrid-Carabanchel', students: 11 },
            { id: '28005568', status: 'Otros', code: '28005568', name: 'CP INF-PRI ISAAC PERAL', zone: 'Madrid-Carabanchel', students: 5 },
            { id: '28005428', status: 'Otros', code: '28005428', name: 'CP EE FRAY PEDRO PONCE DE LEON', zone: 'Madrid-Latina', students: 11 },
            { id: '28021318', status: 'Otros', code: '28021318', name: 'CP INF-PRI CONCHA ESPINA', zone: 'Madrid-Puente de Vallecas', students: 2 },
            { id: '28006391', status: 'Otros', code: '28006391', name: 'CP INF-PRI SANTO DOMINGO', zone: 'Madrid-Puente de Vallecas', students: 1 },
            { id: '28009082', status: 'Otros', code: '28009082', name: 'CPR INF-PRI-SEC SAN EULOGIO', zone: 'Madrid-Villa de Vallecas', students: 4 },
            { id: '28044513', status: 'Otros', code: '28044513', name: 'CEPA VALLECAS', zone: 'Madrid-Villa de Vallecas', students: 1 },
            { id: '28013048', status: 'Otros', code: '28013048', name: 'CPR INF-PRI-SEC COLEGIO LA MILAGROSA', zone: 'Madrid-Carabanchel', students: 16 },
            { id: '28011490', status: 'Otros', code: '28011490', name: 'CPR INF-PRI-SEC EL CARMELO TERESIANO', zone: 'Madrid-Carabanchel', students: 10 },
            { id: '28023935', status: 'Otros', code: '28023935', name: 'CPR INF-PRI-SEC INSTITUTO VERITAS', zone: 'Pozuelo de Alarcón', students: 11 },
            { id: '28019397', status: 'Otros', code: '28019397', name: 'CP INF-PRI FRANCISCO ARRANZ', zone: 'Madrid-Carabanchel', students: 4 },
            { id: '28028805', status: 'Otros', code: '28028805', name: 'CP INF-PRI VICENTE ALEIXANDRE', zone: 'Alcorcón', students: 1 },
            { id: '28072466', status: 'Otros', code: '28072466', name: 'CP INF-PRI MAESTRO PADILLA', zone: 'Madrid-Latina', students: 12 },
            { id: '28012949', status: 'Otros', code: '28012949', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LOS ANGELES', zone: 'Madrid-Usera', students: 6 },
            { id: '28006263', status: 'Otros', code: '28006263', name: 'CP INF-PRI SAN CARLOS', zone: 'Madrid-Villaverde', students: 6 },
            { id: '28030401', status: 'Otros', code: '28030401', name: 'CP INF-PRI PRADOLONGO', zone: 'Madrid-Usera', students: 1 },
            { id: '28039967', status: 'Otros', code: '28039967', name: 'CP INF-PRI ANDRES SEGOVIA', zone: 'Móstoles', students: 5 },
            { id: '28008511', status: 'Otros', code: '28008511', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DEL PILAR', zone: 'Madrid-Salamanca', students: 2 },
            { id: '28011647', status: 'Otros', code: '28011647', name: 'CPR INF-PRI-SEC CORAZON DE MARIA', zone: 'Madrid-Ciudad Lineal', students: 4 },
            { id: '28005994', status: 'Otros', code: '28005994', name: 'CP INF-PRI PADRE COLOMA', zone: 'Madrid-San Blas-Canillejas', students: 1 },
            { id: '28042498', status: 'Otros', code: '28042498', name: 'CPR INF-PRI-SEC LA PRESENTACIÓN FESD', zone: 'Madrid-Vicálvaro', students: 5 },
            { id: '28037946', status: 'Otros', code: '28037946', name: 'CP INF-PRI EL OLIVAR', zone: 'Rivas-Vaciamadrid', students: 1 },
            { id: '28000303', status: 'Otros', code: '28000303', name: 'CPR INF-PRI-SEC ESCUELAS PIAS', zone: 'Alcalá de Henares', students: 1 },
            { id: '28028362', status: 'Otros', code: '28028362', name: 'CP INF-PRI ANDRES MANJON', zone: 'Fuenlabrada', students: 2 },
            { id: '28003523', status: 'Otros', code: '28003523', name: 'CP INF-PRI LEPANTO', zone: 'Leganés', students: 4 },
            { id: '28001010', status: 'Otros', code: '28001010', name: 'CPR INF-PRI-SEC AMOR DE DIOS', zone: 'Alcorcón', students: 6 },
            { id: '28028799', status: 'Otros', code: '28028799', name: 'CP INF-PRI SANTIAGO RAMON Y CAJAL', zone: 'Alcorcón', students: 3 },
            { id: '28025944', status: 'Otros', code: '28025944', name: 'CP INF-PRI LOS CASTILLOS', zone: 'Alcorcón', students: 1 },
            { id: '28010965', status: 'Otros', code: '28010965', name: 'CP INF-PRI REPUBLICA DE COLOMBIA', zone: 'Madrid-Carabanchel', students: 5 },
            { id: '28006160', status: 'Otros', code: '28006160', name: 'CP INF-PRI REPUBLICA DOMINICANA', zone: 'Madrid-Carabanchel', students: 5 },
            { id: '28069251', status: 'Otros', code: '28069251', name: 'CPR INF-PRI-SEC COLEGIO ABACO', zone: 'Madrid-Latina', students: 13 },
            { id: '28029512', status: 'Otros', code: '28029512', name: 'CP INF-PRI SALZILLO-VALLE INCLAN', zone: 'Móstoles', students: 3 },
            { id: '28009641', status: 'Otros', code: '28009641', name: 'CPR INF-PRI-SEC SANTA MARIA DEL PILAR', zone: 'Madrid-Retiro', students: 3 },
            { id: '28015987', status: 'Otros', code: '28015987', name: 'CPR INF-PRI-SEC INMACULADA CONCEPCION', zone: 'Madrid-Salamanca', students: 4 },
            { id: '28013103', status: 'Otros', code: '28013103', name: 'CPR INF-PRI-SEC CALASANCIO NUESTRA SEÑORA DE LAS ESCUELAS PIAS', zone: 'Madrid-Salamanca', students: 7 },
            { id: '28011261', status: 'Otros', code: '28011261', name: 'CPR INF-PRI-SEC AMOROS', zone: 'Madrid-Carabanchel', students: 11 },
            { id: '28009586', status: 'Otros', code: '28009586', name: 'CPR INF-PRI-SEC SANTA MARIA', zone: 'Madrid-Usera', students: 19 },
            { id: '28046391', status: 'Otros', code: '28046391', name: 'CP INF-PRI JUAN DE AUSTRIA', zone: 'Leganés', students: 10 },
            { id: '28003501', status: 'Otros', code: '28003501', name: 'CP INF-PRI CALDERON DE LA BARCA', zone: 'Leganés', students: 1 },
            { id: '28003778', status: 'Otros', code: '28003778', name: 'CP INF-PRI GONZALO DE BERCEO', zone: 'Leganés', students: 1 },
            { id: '28022633', status: 'Otros', code: '28022633', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LAS DELICIAS', zone: 'Madrid-Arganzuela', students: 3 },
            { id: '28018393', status: 'Otros', code: '28018393', name: 'CP INF-PRI ALCALDE DE MOSTOLES', zone: 'Madrid-Carabanchel', students: 2 },
            { id: '28005271', status: 'Otros', code: '28005271', name: 'CP INF-PRI CRISTOBAL COLON', zone: 'Madrid-Usera', students: 5 },
            { id: '28037636', status: 'Otros', code: '28037636', name: 'CP INF-PRI LEON FELIPE', zone: 'Leganés', students: 2 },
            { id: '28015902', status: 'Otros', code: '28015902', name: 'CPR INF-PRI-SEC DIVINA PASTORA', zone: 'Madrid-Chamberí', students: 3 },
            { id: '28072156', status: 'Otros', code: '28072156', name: 'CPR INF-PRI-SEC COLEGIO ARENALES ARROYOMOLINOS', zone: 'Arroyomolinos', students: 1 },
            { id: '28049456', status: 'Otros', code: '28049456', name: 'CP INF-PRI SEVERO OCHOA', zone: 'Móstoles', students: 4 },
            { id: '28038276', status: 'Otros', code: '28038276', name: 'CP INF-PRI ANDRES SEGOVIA', zone: 'Leganés', students: 2 },
            { id: '28028210', status: 'Otros', code: '28028210', name: 'CP INF-PRI PEREZ GALDOS', zone: 'Leganés', students: 3 },
            { id: '28025841', status: 'Otros', code: '28025841', name: 'CP INF-PRI CIUDAD DE GETAFE', zone: 'Getafe', students: 2 },
            { id: '28003584', status: 'Otros', code: '28003584', name: 'CPR INF-PRI-SEC LA INMACULADA', zone: 'Leganés', students: 7 },
            { id: '28025336', status: 'Otros', code: '28025336', name: 'CPR INF-PRI-SEC SAN JOSE', zone: 'Valdemoro', students: 9 },
            { id: '28034027', status: 'Otros', code: '28034027', name: 'CP INF-PRI ANTONIO MACHADO', zone: 'Parla', students: 2 },
            { id: '28076320', status: 'Otros', code: '28076320', name: 'CP INF-PRI BLAS DE LEZO', zone: 'Parla', students: 7 },
            { id: '28025968', status: 'Otros', code: '28025968', name: 'CP INF-PRI NUESTRA SEÑORA DE LA FUENCISLA', zone: 'Madrid-Usera', students: 3 },
            { id: '28015562', status: 'Otros', code: '28015562', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LA PROVIDENCIA', zone: 'Madrid-Usera', students: 8 },
            { id: '28006202', status: 'Otros', code: '28006202', name: 'CP INF-PRI REPUBLICA DE VENEZUELA', zone: 'Madrid-Usera', students: 7 },
            { id: '28001563', status: 'Otros', code: '28001563', name: 'CPR INF-PRI-SEC APOSTOL SANTIAGO', zone: 'Aranjuez', students: 4 },
            { id: '28013097', status: 'Otros', code: '28013097', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LAS ESCUELAS PIAS', zone: 'Madrid-Latina', students: 7 },
            { id: '28038598', status: 'Otros', code: '28038598', name: 'CPR INF-PRI-SEC ALTAMIRA', zone: 'Fuenlabrada', students: 8 },
            { id: '28069285', status: 'Otros', code: '28069285', name: 'CPR INF-PRI-SEC COLEGIO GAUDEM', zone: 'Madrid-Barajas', students: 2 },
            { id: '28005441', status: 'Otros', code: '28005441', name: 'CP INF-PRI GONZALO FERNANDEZ DE CORDOBA', zone: 'Madrid-Latina', students: 2 },
            { id: '28006044', status: 'Otros', code: '28006044', name: 'CP INF-PRI PARQUE ALUCHE', zone: 'Madrid-Latina', students: 5 },
            { id: '28013504', status: 'Otros', code: '28013504', name: 'CPR INF-PRI-SEC PATROCINIO DE SAN JOSE', zone: 'Madrid-Tetuán', students: 3 },
            { id: '28028854', status: 'Otros', code: '28028854', name: 'CP INF-PRI DIONISIO RIDRUEJO', zone: 'Madrid-Hortaleza', students: 3 },
            { id: '28031063', status: 'Otros', code: '28031063', name: 'CP INF-PRI BREOGAN', zone: 'Madrid-Fuencarral-El Pardo', students: 6 },
            { id: '28010989', status: 'Otros', code: '28010989', name: 'CP INF-PRI REPUBLICA DE EL SALVADOR', zone: 'Madrid-Villaverde', students: 9 },
            { id: '28067598', status: 'Otros', code: '28067598', name: 'CP INF-PRI SAN MARTIN DE TOURS', zone: 'San Martín de Valdeiglesias', students: 5 },
            { id: '28010539', status: 'Otros', code: '28010539', name: 'CP INF-PRI CUBA', zone: 'Madrid-Latina', students: 14 },
            { id: '28023893', status: 'Otros', code: '28023893', name: 'CPR EE GIL GAYARRE', zone: 'Pozuelo de Alarcón', students: 3 },
            { id: '28700404', status: 'Otros', code: '28700404', name: 'EOEP GENERAL EQUIPO GENERAL LEGANES', zone: 'Leganés', students: 5 },
            { id: '28029615', status: 'Otros', code: '28029615', name: 'CP INF-PRI MIGUEL HERNANDEZ', zone: 'Fuenlabrada', students: 1 },
            { id: '28008910', status: 'Otros', code: '28008910', name: 'CPR INF-PRI-SEC SAGRADO CORAZON', zone: 'Madrid-Villa de Vallecas', students: 2 },
            { id: '28075649', status: 'Otros', code: '28075649', name: 'CPR INF-PRI-SEC COLEGIO SANTA MONICA', zone: 'Rivas-Vaciamadrid', students: 3 },
            { id: '28010497', status: 'Otros', code: '28010497', name: 'CP INF-PRI CONCEPCION ARENAL', zone: 'Madrid-Carabanchel', students: 4 },
            { id: '28005726', status: 'Otros', code: '28005726', name: 'CP INF-PRI JUAN SEBASTIAN ELCANO', zone: 'Madrid-Usera', students: 2 },
            { id: '28022499', status: 'Otros', code: '28022499', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE FATIMA', zone: 'Madrid-Usera', students: 3 },
            { id: '28007954', status: 'Otros', code: '28007954', name: 'CPR INF-PRI-SEC MARIA REINA', zone: 'Madrid-Usera', students: 4 },
            { id: '28005911', status: 'Otros', code: '28005911', name: 'CP INF-PRI NAVAS DE TOLOSA', zone: 'Madrid-Villaverde', students: 14 },
            { id: '28035676', status: 'Libre', code: '28035676', name: 'CP INF-PRI LA ESCUELA', zone: 'Rivas-Vaciamadrid', students: 2 },
            { id: '28045301', status: 'Libre', code: '28045301', name: 'CP INF-PRI LA PALOMA', zone: 'Parla', students: 5 },
            { id: '28023534', status: 'Libre', code: '28023534', name: 'CP INF-PRI MAGERIT', zone: 'Parla', students: 12 },
            { id: '28042243', status: 'Libre', code: '28042243', name: 'CP INF-PRI FRAY PEDRO DE AGUADO', zone: 'Valdemoro', students: 3 },
            { id: '28025351', status: 'Libre', code: '28025351', name: 'CP INF-PRI VICENTE ALEIXANDRE', zone: 'Valdemoro', students: 2 },
            { id: '28063908', status: 'Libre', code: '28063908', name: 'CP INF-PRI FUENTE DE LA VILLA', zone: 'Valdemoro', students: 2 },
            { id: '28077336', status: 'Libre', code: '28077336', name: 'CP INF-PRI AVERROES', zone: 'Arroyomolinos', students: 3 },
            { id: '28006056', status: 'Libre', code: '28006056', name: 'CP INF-PRI PERU', zone: 'Madrid-Carabanchel', students: 7 },
            { id: '28006469', status: 'Libre', code: '28006469', name: 'CP INF-PRI ARCIPRESTE DE HITA', zone: 'Madrid-Carabanchel', students: 4 },
            { id: '28005155', status: 'Libre', code: '28005155', name: 'CP INF-PRI BOLIVIA', zone: 'Madrid-Latina', students: 2 },
            { id: '28007139', status: 'Libre', code: '28007139', name: 'CPR INF-PRI-SEC CRISTO REY', zone: 'Madrid-Latina', students: 1 },
            { id: '28010576', status: 'Libre', code: '28010576', name: 'CP INF-PRI ERMITA DEL SANTO', zone: 'Madrid-Latina', students: 2 },
            { id: '28014193', status: 'Libre', code: '28014193', name: 'CPR INF-PRI-SEC SALESIANOS PASEO DE EXTREMADURA', zone: 'Madrid-Latina', students: 3 },
            { id: '28033783', status: 'Libre', code: '28033783', name: 'CP INF-PRI CONCEPCION ARENAL', zone: 'Getafe', students: 4 },
            { id: '28033722', status: 'Libre', code: '28033722', name: 'CP INF-PRI GINER DE LOS RIOS', zone: 'Leganés', students: 4 },
            { id: '28037715', status: 'Libre', code: '28037715', name: 'CP INF-PRI ROSA LUXEMBURGO', zone: 'Parla', students: 1 },
            { id: '28023698', status: 'Libre', code: '28023698', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LA PROVIDENCIA', zone: 'Pinto', students: 1 },
            { id: '28038562', status: 'Libre', code: '28038562', name: 'CPR INF-PRI-SEC ALKOR', zone: 'Alcorcón', students: 2 },
            { id: '28001149', status: 'Libre', code: '28001149', name: 'CP INF-PRI PARROCO D. VICTORIANO', zone: 'Alcorcón', students: 3 },
            { id: '28001794', status: 'Libre', code: '28001794', name: 'CP INF-PRI EL TORREON', zone: 'Arroyomolinos', students: 2 },
            { id: '28023364', status: 'Libre', code: '28023364', name: 'CP INF-PRI-SEC ISABEL LA CATOLICA', zone: 'Navas del Rey', students: 4 },
            { id: '28010722', status: 'Libre', code: '28010722', name: 'CP INF-PRI JOAQUIN COSTA', zone: 'Madrid-Arganzuela', students: 1 },
            { id: '28006275', status: 'Libre', code: '28006275', name: 'CP INF-PRI SAN EUGENIO Y SAN ISIDRO', zone: 'Madrid-Arganzuela', students: 1 },
            { id: '28045608', status: 'Libre', code: '28045608', name: 'CEPA ARGANZUELA', zone: 'Madrid-Arganzuela', students: 1 },
            { id: '28005131', status: 'Libre', code: '28005131', name: 'CPR INF-PRI-SEC BEATA MARIA ANA DE JESUS', zone: 'Madrid-Arganzuela', students: 1 },
            { id: '28016694', status: 'Libre', code: '28016694', name: 'CPR INF-PRI-SEC COLEGIO NUESTRA SEÑORA DE LORETO FESD', zone: 'Madrid-Salamanca', students: 1 },
            { id: '28011911', status: 'Libre', code: '28011911', name: 'CPR INF-PRI-SEC MONTPELLIER', zone: 'Madrid-Ciudad Lineal', students: 2 },
            { id: '28007127', status: 'Libre', code: '28007127', name: 'CPR INF-PRI-SEC CRISTO REY', zone: 'Madrid-Hortaleza', students: 2 },
            { id: '28013784', status: 'Libre', code: '28013784', name: 'CPR INF-PRI-SEC SAGRADO CORAZON DE JESUS', zone: 'Madrid-Moncloa-Aravaca', students: 1 },
            { id: '28021690', status: 'Libre', code: '28021690', name: 'CPR INF-PRI-SEC BERNADETTE', zone: 'Madrid-Moncloa-Aravaca', students: 1 },
            { id: '28041767', status: 'Libre', code: '28041767', name: 'CP INF-PRI ROSA LUXEMBURGO', zone: 'Madrid-Moncloa-Aravaca', students: 1 },
            { id: '28019592', status: 'Libre', code: '28019592', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LOS DOLORES', zone: 'Madrid-Carabanchel', students: 9 },
            { id: '28006111', status: 'Libre', code: '28006111', name: 'CP INF-PRI GONZALO DE BERCEO', zone: 'Madrid-Carabanchel', students: 4 },
            { id: '28031488', status: 'Libre', code: '28031488', name: 'CP INF-PRI JULIAN BESTEIRO', zone: 'Madrid-Carabanchel', students: 10 },
            { id: '28006305', status: 'Libre', code: '28006305', name: 'CP INF-PRI SAN IGNACIO DE LOYOLA', zone: 'Madrid-Carabanchel', students: 1 },
            { id: '28005039', status: 'Libre', code: '28005039', name: 'CP INF-PRI ANTONIO MACHADO', zone: 'Madrid-Carabanchel', students: 3 },
            { id: '28005684', status: 'Libre', code: '28005684', name: 'CP INF-PRI JOVELLANOS', zone: 'Madrid-Carabanchel', students: 3 },
            { id: '28009525', status: 'Libre', code: '28009525', name: 'CPR INF-PRI-SEC SANTA GEMA GALGANI', zone: 'Madrid-Latina', students: 2 },
            { id: '28009276', status: 'Libre', code: '28009276', name: 'CPR EE INSTITUTO SAN JOSE', zone: 'Madrid-Latina', students: 1 },
            { id: '28005556', status: 'Libre', code: '28005556', name: 'CP EE MARIA SORIANO', zone: 'Madrid-Latina', students: 4 },
            { id: '28004904', status: 'Libre', code: '28004904', name: 'CP INF-PRI CIUDAD DE JAEN', zone: 'Madrid-Usera', students: 1 },
            { id: '28035536', status: 'Libre', code: '28035536', name: 'CP INF-PRI GLORIA FUERTES', zone: 'Madrid-Usera', students: 4 },
            { id: '28032109', status: 'Libre', code: '28032109', name: 'CPR INF SANTA LUISA', zone: 'Madrid-Villaverde', students: 2 },
            { id: '28028416', status: 'Libre', code: '28028416', name: 'CP INF-PRI PASAMONTE', zone: 'Madrid-Moratalaz', students: 2 },
            { id: '28005350', status: 'Libre', code: '28005350', name: 'CP INF-PRI FRANCISCO FATOU', zone: 'Madrid-Villa de Vallecas', students: 2 },
            { id: '28081571', status: 'Libre', code: '28081571', name: 'CPR INF-PRI-SEC GSD LAS ARTES', zone: 'Madrid-Villa de Vallecas', students: 1 },
            { id: '28034933', status: 'Libre', code: '28034933', name: 'CPR INF-PRI-SEC NUEVA CASTILLA', zone: 'Madrid-Villa de Vallecas', students: 3 },
            { id: '28065784', status: 'Libre', code: '28065784', name: 'CPR INF-PRI-SEC COLEGIO CAUDE', zone: 'Majadahonda', students: 1 },
            { id: '28002166', status: 'Libre', code: '28002166', name: 'CP INF-PRI VENTURA RODRIGUEZ', zone: 'Ciempozuelos', students: 6 },
            { id: '28039323', status: 'Libre', code: '28039323', name: 'CP EE JUAN XXIII', zone: 'Fuenlabrada', students: 3 },
            { id: '28049390', status: 'Libre', code: '28049390', name: 'CP INF-PRI ANTONIO MACHADO', zone: 'Fuenlabrada', students: 2 },
            { id: '28067771', status: 'Libre', code: '28067771', name: 'CP INF-PRI MANUELA MALASAÑA', zone: 'Fuenlabrada', students: 4 },
            { id: '28003316', status: 'Libre', code: '28003316', name: 'CP INF-PRI SAN JOSE DE CALASANZ', zone: 'Getafe', students: 2 },
            { id: '28035470', status: 'Libre', code: '28035470', name: 'CP INF-PRI GABRIEL GARCIA MARQUEZ', zone: 'Getafe', students: 1 },
            { id: '28057039', status: 'Libre', code: '28057039', name: 'CP INF-PRI GLORIA FUERTES', zone: 'Getafe', students: 2 },
            { id: '28032468', status: 'Libre', code: '28032468', name: 'CP INF-PRI MIGUEL HERNANDEZ', zone: 'Getafe', students: 10 },
            { id: '28026420', status: 'Libre', code: '28026420', name: 'CPR INF-PRI-SEC LOS ANGELES', zone: 'Getafe', students: 1 },
            { id: '28069340', status: 'Libre', code: '28069340', name: 'CP INF-PRI DAOIZ Y VELARDE', zone: 'Getafe', students: 4 },
            { id: '28028830', status: 'Libre', code: '28028830', name: 'CP INF-PRI FRANCISCO DE QUEVEDO', zone: 'Leganés', students: 2 },
            { id: '28035640', status: 'Libre', code: '28035640', name: 'CP INF-PRI LUIS VIVES', zone: 'Parla', students: 2 },
            { id: '28060312', status: 'Libre', code: '28060312', name: 'CP INF-PRI DULCE CHACON', zone: 'Rivas-Vaciamadrid', students: 1 },
            { id: '28000960', status: 'Libre', code: '28000960', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LOS REMEDIOS', zone: 'Alcorcón', students: 3 },
            { id: '28063854', status: 'Libre', code: '28063854', name: 'CP INF-PRI FUENTE DEL PALOMAR', zone: 'Alcorcón', students: 2 },
            { id: '28032389', status: 'Libre', code: '28032389', name: 'CP INF-PRI MIGUEL HERNANDEZ', zone: 'Alcorcón', students: 9 },
            { id: '28037624', status: 'Libre', code: '28037624', name: 'CP EE ALFONSO X EL SABIO', zone: 'Leganés', students: 3 },
            { id: '28041792', status: 'Libre', code: '28041792', name: 'CP INF-PRI LOS ALMENDROS', zone: 'Rivas-Vaciamadrid', students: 2 },
            { id: '28074074', status: 'Libre', code: '28074074', name: 'CPR INF-PRI-SEC COLEGIO PASTEUR ARROYOMOLINOS', zone: 'Arroyomolinos', students: 2 },
            { id: '28067550', status: 'Libre', code: '28067550', name: 'CP INF-PRI LEGAZPI', zone: 'Arroyomolinos', students: 2 },
            { id: '28050458', status: 'Libre', code: '28050458', name: 'CP INF-PRI FEDERICO GARCIA LORCA', zone: 'Boadilla del Monte', students: 3 },
            { id: '28060324', status: 'Libre', code: '28060324', name: 'CP INF-PRI TERESA BERGANZA', zone: 'Boadilla del Monte', students: 2 },
            { id: '28013115', status: 'Libre', code: '28013115', name: 'CPR INF-PRI-SEC NUESTRA SEÑORA DE LAS ESCUELAS PIAS', zone: 'Madrid-Carabanchel', students: 6 },
            { id: '28067318', status: 'Libre', code: '28067318', name: 'CPR INF-PRI-SEC COLEGIO ARTICA', zone: 'Madrid-Latina', students: 2 },
            { id: '28015537', status: 'Libre', code: '28015537', name: 'CPR INF-PRI CUMBRE-OXFORD', zone: 'Madrid-Puente de Vallecas', students: 8 },
            { id: '28040520', status: 'Libre', code: '28040520', name: 'CPR INF-PRI-SEC ZAZUAR', zone: 'Madrid-Villa de Vallecas', students: 7 },
            { id: '28070846', status: 'Libre', code: '28070846', name: 'CPR INF-PRI-SEC COLEGIO TORREVILANO', zone: 'Madrid-Villa de Vallecas', students: 6 },
            { id: '28023947', status: 'Libre', code: '28023947', name: 'CPR INF-PRI-SEC ESCUELAS PIAS DE SAN FERNANDO', zone: 'Pozuelo de Alarcón', students: 5 },
            { id: '28065528', status: 'Libre', code: '28065528', name: 'CP INF-PRI CARLOS CANO', zone: 'Fuenlabrada', students: 5 },
            { id: '28040842', status: 'Libre', code: '28040842', name: 'CP INF-PRI LORANCA', zone: 'Fuenlabrada', students: 14 },
            { id: '28069182', status: 'Libre', code: '28069182', name: 'CP INF-PRI MANUEL DE FALLA', zone: 'Fuenlabrada', students: 1 },
            { id: '28026523', status: 'Libre', code: '28026523', name: 'CP INF-PRI CERVANTES', zone: 'Fuenlabrada', students: 5 },
            { id: '28003250', status: 'Libre', code: '28003250', name: 'CPR INF-PRI-SEC LA INMACULADA-PADRES ESCOLAPIOS', zone: 'Getafe', students: 1 },
            { id: '28003134', status: 'Libre', code: '28003134', name: 'CPR INF-PRI-SEC SAN JOSE FESD', zone: 'Getafe', students: 7 },
            { id: '28073914', status: 'Libre', code: '28073914', name: 'CP INF-PRI EMPERADOR CARLOS V', zone: 'Getafe', students: 4 },
            { id: '28002968', status: 'Libre', code: '28002968', name: 'CP INF-PRI SANTA MARGARITA MARIA ALACOQUE', zone: 'Getafe', students: 8 },
            { id: '28002944', status: 'Libre', code: '28002944', name: 'CP INF-PRI LA ALHONDIGA', zone: 'Getafe', students: 8 },
            { id: '28045153', status: 'Libre', code: '28045153', name: 'CP INF-PRI JACINTO BENAVENTE', zone: 'Leganés', students: 3 },
            { id: '28003833', status: 'Libre', code: '28003833', name: 'CP INF-PRI MIGUEL DE CERVANTES', zone: 'Leganés', students: 3 },
            { id: '28038288', status: 'Libre', code: '28038288', name: 'CP INF-PRI MIGUEL DELIBES', zone: 'Leganés', students: 6 },
            { id: '28001046', status: 'Libre', code: '28001046', name: 'CPR INF-PRI-SEC CENTRO EDUCATIVO VILLA DE ALCORCON', zone: 'Alcorcón', students: 2 },
            { id: '28000856', status: 'Libre', code: '28000856', name: 'CP INF-PRI CARMEN CONDE', zone: 'Alcorcón', students: 2 },
            { id: '28033679', status: 'Libre', code: '28033679', name: 'CP INF-PRI-SEC MIGUEL DE CERVANTES', zone: 'Alcorcón', students: 3 },
            { id: '28028891', status: 'Libre', code: '28028891', name: 'CP INF-PRI LAS CUMBRES', zone: 'Móstoles', students: 8 },
            { id: '28067707', status: 'Libre', code: '28067707', name: 'CPR INF-PRI-SEC COLEGIO SEI CONCEPCIÓN', zone: 'Navalcarnero', students: 11 },
            { id: '28057881', status: 'Libre', code: '28057881', name: 'CPR INF-PRI-SEC VILLA DE NAVALCARNERO', zone: 'Navalcarnero', students: 9 },
            { id: '28070101', status: 'Libre', code: '28070101', name: 'CPR INF-PRI-SEC LOS NOGALES', zone: 'Álamo, El', students: 4 },
            { id: '28013887', status: 'Libre', code: '28013887', name: 'CPR INF-PRI-SEC SAN ALFONSO', zone: 'Madrid-Centro', students: 6 },
            { id: '28008387', status: 'Libre', code: '28008387', name: 'CPR INF-PRI-SEC OBRA SO.N.S.MONTSERRAT-S.SIMON Y S.JUDAS', zone: 'Madrid-Usera', students: 3 },
            { id: '28003791', status: 'Libre', code: '28003791', name: 'CP INF-PRI VICTOR PRADERA', zone: 'Leganés', students: 3 }
        ];

        // --- COMPONENTES ---

        // 1. Header
        const Header = () => (
            <header className="bg-corporate-dark text-white px-6 py-4 shadow-md flex items-center gap-3 shrink-0 z-50 relative">
                <div className="p-2 bg-corporate-blue rounded-lg">
                    <GraduationCap size={24} className="text-white" />
                </div>
                <div>
                    <h1 className="text-xl font-semibold tracking-wide">Portal de Gestión Docente</h1>
                    <p className="text-xs text-gray-300 font-light">Selección de Centros de Prácticas</p>
                </div>
            </header>
        );

        // 2. TeacherForm (Updated with Autocomplete)
        const TeacherForm = ({ teacherName, setTeacherName, teacherDNI, setTeacherDNI, nameError, dniError }) => {
            const [showSuggestions, setShowSuggestions] = useState(false);
            const dropdownRef = useRef(null);

            // Filtrar lista basada en lo que escribe el usuario
            const filteredTeachers = useMemo(() => {
                if (!teacherName) return TEACHER_LIST;
                return TEACHER_LIST.filter(teacher => 
                teacher.toLowerCase().includes(teacherName.toLowerCase())
                );
            }, [teacherName]);

            // Manejar clic fuera para cerrar sugerencias
            useEffect(() => {
                const handleClickOutside = (event) => {
                if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                    setShowSuggestions(false);
                }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const handleSelectTeacher = (name) => {
                setTeacherName(name);
                setShowSuggestions(false);
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 mb-6">
                <h2 className="text-corporate-dark font-semibold mb-4 flex items-center gap-2 border-b pb-2">
                    <User size={18} className="text-corporate-blue" />
                    Datos del Profesor
                </h2>
                
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="md:col-span-2 flex flex-col relative" ref={dropdownRef}>
                        <label htmlFor="teacherName" className="text-sm font-medium text-gray-600 mb-1">
                            Nombre y Apellidos <span className="text-red-500 font-bold" title="Campo obligatorio">*</span>
                        </label>
                        <div className="relative w-full">
                            <input
                            id="teacherName"
                            type="text"
                            value={teacherName}
                            onChange={(e) => {
                                setTeacherName(e.target.value);
                                setShowSuggestions(true);
                            }}
                            onFocus={() => setShowSuggestions(true)}
                            placeholder="Ej: María García López (o seleccione de la lista)"
                            autoComplete="off"
                            className={`w-full p-2 pr-8 border rounded bg-white text-gray-900 outline-none transition-all ${
                                nameError 
                                ? 'border-red-500 ring-1 ring-red-500 focus:border-red-500' 
                                : 'border-gray-300 focus:ring-2 focus:ring-corporate-blue focus:border-transparent'
                            }`}
                            />
                            
                            <div className="absolute right-3 top-2.5 text-gray-400 pointer-events-none">
                                {nameError ? <AlertCircle size={18} className="text-red-500 animate-pulse" /> : <ChevronDown size={16} />}
                            </div>

                            {/* Lista de Sugerencias */}
                            {showSuggestions && (
                            <ul className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto">
                                {filteredTeachers.length > 0 ? (
                                filteredTeachers.map((name, index) => (
                                    <li 
                                    key={index}
                                    onClick={() => handleSelectTeacher(name)}
                                    className="px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-corporate-blue cursor-pointer transition-colors border-b border-gray-50 last:border-0"
                                    >
                                    {name}
                                    </li>
                                ))
                                ) : (
                                <li className="px-4 py-2 text-sm text-gray-400 italic">
                                    No hay coincidencias. Puede escribir un nombre nuevo.
                                </li>
                                )}
                            </ul>
                            )}
                        </div>
                    </div>

                    <div className="md:col-span-1 flex flex-col">
                        <label htmlFor="teacherDNI" className="text-sm font-medium text-gray-600 mb-1">
                            DNI <span className="text-red-500 font-bold" title="Campo obligatorio">*</span>
                        </label>
                        <div className="relative w-full">
                            <input
                                id="teacherDNI"
                                type="text"
                                value={teacherDNI}
                                onChange={(e) => setTeacherDNI(e.target.value)}
                                placeholder="Ej: 12345678Z"
                                className={`w-full p-2 border rounded bg-white text-gray-900 outline-none transition-all ${
                                    dniError 
                                        ? 'border-red-500 ring-1 ring-red-500 focus:border-red-500' 
                                        : 'border-gray-300 focus:ring-2 focus:ring-corporate-blue focus:border-transparent'
                                }`}
                            />
                            {dniError && (
                                <div className="absolute right-3 top-2.5 text-red-500 animate-pulse">
                                    <AlertCircle size={18} />
                                </div>
                            )}
                        </div>
                    </div>
                </div>

                {(nameError || dniError) && (
                    <p className="text-red-500 text-xs mt-2 font-medium flex items-center gap-1">
                        <AlertCircle size={12} />
                        Por favor, rellene todos los campos obligatorios para poder exportar.
                    </p>
                )}
                </div>
            );
        };

        // 3. SearchFilters
        const SearchFilters = ({ filters, setFilters }) => {
            const handleChange = (e) => {
                const { name, value } = e.target;
                setFilters(prev => ({ ...prev, [name]: value }));
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 mb-6">
                    <h2 className="text-corporate-dark font-semibold mb-4 flex items-center gap-2 border-b pb-2">
                        <Search size={18} className="text-corporate-blue" />
                        Buscador de Centros
                    </h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {['Nombre del Centro', 'Zona / Distrito', 'Código de Centro'].map((label, idx) => {
                            const name = ['name', 'zone', 'code'][idx];
                            const placeholder = ['Buscar por nombre...', 'Ej: Centro, Hortaleza...', 'Ej: 2800...'][idx];
                            const Icon = [School, MapPin, Hash][idx];
                            
                            return (
                                <div key={name} className="relative">
                                    <label className="text-xs font-bold text-gray-400 uppercase mb-1 block">{label}</label>
                                    <div className="relative">
                                        <Icon size={16} className="absolute left-3 top-3 text-gray-400" />
                                        <input
                                            type="text"
                                            name={name}
                                            value={filters[name]}
                                            onChange={handleChange}
                                            placeholder={placeholder}
                                            className="w-full pl-9 p-2 border border-gray-300 rounded text-sm bg-white text-gray-900 focus:ring-1 focus:ring-corporate-blue focus:border-corporate-blue outline-none"
                                        />
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // 4. CenterTable
        const CenterTable = ({ centers, selectedIds, onAdd, sortConfig, onSort }) => {
            const getStatusColor = (status) => {
                if (status.startsWith('Disponible')) return 'bg-sky-100 text-sky-800 border-sky-200';
                if (status === 'Libre') return 'bg-emerald-100 text-emerald-800 border-emerald-200';
                return 'bg-gray-100 text-gray-700 border-gray-200'; 
            };

            const renderSortIcon = (key) => {
                if (sortConfig.key !== key) return <div className="w-3.5 h-3.5 ml-1 inline-block opacity-0 group-hover:opacity-30 transition-opacity"><ArrowUp size={14} /></div>;
                return sortConfig.direction === 'asc' 
                ? <ArrowUp size={14} className="ml-1 text-corporate-blue inline-block" />
                : <ArrowDown size={14} className="ml-1 text-corporate-blue inline-block" />;
            };

            const headerClass = "px-4 py-3 tracking-wider cursor-pointer hover:bg-gray-200 transition-colors select-none group";

            return (
                <div className="bg-white rounded-lg shadow-sm border border-gray-100 flex-1 overflow-hidden flex flex-col min-h-[400px]">
                    <div className="p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                        <h2 className="text-corporate-dark font-semibold flex items-center gap-2">
                            <School size={18} className="text-corporate-blue" />
                            Resultados ({centers.length})
                        </h2>
                    </div>
                    
                    <div className="overflow-auto flex-1">
                        <table className="w-full text-left text-sm text-gray-600">
                            <thead className="bg-gray-100 text-gray-700 uppercase font-bold text-xs sticky top-0 shadow-sm z-10">
                                <tr>
                                    <th className={`${headerClass} w-24`} onClick={() => onSort('status')}>
                                        Estado {renderSortIcon('status')}
                                    </th>
                                    <th className={headerClass} onClick={() => onSort('code')}>
                                        Código {renderSortIcon('code')}
                                    </th>
                                    <th className={headerClass} onClick={() => onSort('name')}>
                                        Nombre {renderSortIcon('name')}
                                    </th>
                                    <th className={headerClass} onClick={() => onSort('zone')}>
                                        Zona {renderSortIcon('zone')}
                                    </th>
                                    <th className={`${headerClass} text-center`} onClick={() => onSort('students')}>
                                        Nº Est. {renderSortIcon('students')}
                                    </th>
                                    <th className="px-4 py-3 tracking-wider text-right cursor-default">
                                        Acción
                                    </th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {centers.length > 0 ? (
                                    centers.map((center) => {
                                        const isSelected = selectedIds.has(center.id);
                                        return (
                                            <tr key={center.id} className={`hover:bg-blue-50 transition-colors ${isSelected ? 'bg-gray-50 opacity-60' : ''}`}>
                                                <td className="px-4 py-3">
                                                    <span 
                                                        className={`px-2 py-1 rounded-full text-[10px] font-bold border uppercase tracking-wide inline-flex items-center gap-1 ${getStatusColor(center.status)}`}
                                                    >
                                                        {center.status.split(' ')[0]} 
                                                    </span>
                                                </td>
                                                <td className="px-4 py-3 font-mono text-gray-500 text-xs">{center.code}</td>
                                                <td className="px-4 py-3 font-medium text-corporate-dark">{center.name}</td>
                                                <td className="px-4 py-3">{center.zone}</td>
                                                <td className="px-4 py-3 text-center font-semibold text-gray-700">{center.students}</td>
                                                <td className="px-4 py-3 text-right">
                                                    <button
                                                        onClick={() => onAdd(center)}
                                                        disabled={isSelected}
                                                        className={`inline-flex items-center gap-1 px-3 py-1.5 rounded text-xs font-semibold uppercase tracking-wide transition-all ${
                                                            isSelected
                                                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                                                : 'bg-corporate-blue text-white hover:bg-sky-600 shadow-sm'
                                                        }`}
                                                    >
                                                        {isSelected ? 'Añadido' : <><Plus size={14} /> Añadir</>}
                                                    </button>
                                                </td>
                                            </tr>
                                        );
                                    })
                                ) : (
                                    <tr>
                                        <td colSpan={6} className="px-6 py-10 text-center text-gray-400 italic">
                                            No se han encontrado centros con los filtros actuales.
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // 5. SelectedList (Actualizado con Loading State)
        const SelectedList = ({ selectedCenters, onRemove, onMove, onExport, isUploading }) => {
            const maxCenters = 18;
            const count = selectedCenters.length;

            return (
                <div className="bg-white h-full flex flex-col shadow-[-4px_0_15px_-3px_rgba(0,0,0,0.1)] border-l border-gray-200 w-full">
                    <div className="p-5 border-b border-gray-200 bg-white shrink-0">
                        <h3 className="font-semibold text-lg flex items-center justify-between text-corporate-dark">
                            Centros Seleccionados
                            <span className={`text-xs px-2 py-1 rounded-full text-white ${count === maxCenters ? 'bg-red-500' : 'bg-corporate-blue'}`}>
                                {count} / {maxCenters} (Máx)
                            </span>
                        </h3>
                        <p className="text-xs text-gray-500 mt-1">Orden de preferencia. Puede seleccionar hasta {maxCenters} centros (no obligatorio completar todos).</p>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 relative">
                        {count === 0 ? (
                            <div className="h-full flex flex-col items-center justify-center text-gray-400 text-center p-4">
                                <CheckCircle size={48} className="mb-2 opacity-20" />
                                <p className="text-sm">No hay centros seleccionados.</p>
                                <p className="text-xs mt-1">Añade centros desde la tabla de la izquierda.</p>
                            </div>
                        ) : (
                            selectedCenters.map((center, index) => (
                                <div key={center.id} className="group bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-all flex flex-col gap-2 relative">
                                    <div className="flex justify-between items-start">
                                        <div className="flex items-center gap-2">
                                            <div className="bg-corporate-blue text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full shrink-0">
                                                {index + 1}
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-sm text-corporate-dark leading-tight">{center.name}</h4>
                                                <div className="flex gap-2 text-xs text-gray-500 mt-0.5">
                                                    <span className="bg-gray-100 px-1 rounded font-mono">{center.code}</span>
                                                    <span>{center.zone}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={() => onRemove(center.id)}
                                            className="text-gray-300 hover:text-red-500 transition-colors p-1"
                                            title="Eliminar"
                                            disabled={isUploading}
                                        >
                                            <Trash2 size={16} />
                                        </button>
                                    </div>

                                    <div className="flex justify-end gap-1 mt-1 border-t border-gray-100 pt-2">
                                        <button 
                                            onClick={() => onMove(index, 'up')}
                                            disabled={index === 0 || isUploading}
                                            className="p-1 text-gray-400 hover:text-corporate-blue disabled:opacity-20 disabled:cursor-not-allowed hover:bg-blue-50 rounded"
                                        >
                                            <ArrowUp size={16} />
                                        </button>
                                        <button 
                                            onClick={() => onMove(index, 'down')}
                                            disabled={index === count - 1 || isUploading}
                                            className="p-1 text-gray-400 hover:text-corporate-blue disabled:opacity-20 disabled:cursor-not-allowed hover:bg-blue-50 rounded"
                                        >
                                            <ArrowDown size={16} />
                                        </button>
                                    </div>
                                </div>
                            ))
                        )}
                        
                        {/* Overlay de Carga */}
                        {isUploading && (
                            <div className="absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center text-corporate-blue">
                                <Loader2 size={40} className="animate-spin-custom mb-3" />
                                <p className="font-semibold text-sm animate-pulse">Enviando a Drive...</p>
                            </div>
                        )}
                    </div>

                    <div className="p-4 bg-white border-t border-gray-200 shrink-0">
                        <button
                            onClick={onExport}
                            disabled={count === 0 || isUploading}
                            className={`w-full flex items-center justify-center gap-2 text-white py-3 rounded-lg font-bold shadow-lg transition-all active:scale-[0.98] ${
                                isUploading 
                                    ? 'bg-gray-400 cursor-wait' 
                                    : 'bg-green-600 hover:bg-green-700 shadow-green-600/20 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none'
                            }`}
                        >
                            {isUploading ? (
                                <>
                                    <Loader2 size={20} className="animate-spin-custom" />
                                    Procesando...
                                </>
                            ) : (
                                <>
                                    {GOOGLE_SCRIPT_URL ? <UploadCloud size={20} /> : <FileDown size={20} />}
                                    {GOOGLE_SCRIPT_URL ? 'Enviar y Guardar' : 'Finalizar y Exportar'}
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [teacherName, setTeacherName] = useState('');
            const [teacherDNI, setTeacherDNI] = useState('');
            const [nameError, setNameError] = useState(false);
            const [dniError, setDniError] = useState(false);
            const [selectedCenters, setSelectedCenters] = useState([]);
            const [filters, setFilters] = useState({ name: '', zone: '', code: '' });
            // Estado para la ordenación
            const [sortConfig, setSortConfig] = useState({ key: 'name', direction: 'asc' });
            const [isUploading, setIsUploading] = useState(false);

            const handleNameChange = (name) => {
                setTeacherName(name);
                if (nameError && name.trim().length > 0) setNameError(false);
            };

            const handleDNIChange = (dni) => {
                setTeacherDNI(dni);
                if (dniError && dni.trim().length > 0) setDniError(false);
            };

            const handleSort = (key) => {
                setSortConfig(current => ({
                    key,
                    direction: current.key === key && current.direction === 'asc' ? 'desc' : 'asc'
                }));
            };

            const filteredCenters = useMemo(() => {
                // 1. Filtrar
                const filtered = MOCK_CENTERS.filter(center => {
                    const matchName = center.name.toLowerCase().includes(filters.name.toLowerCase());
                    const matchZone = center.zone.toLowerCase().includes(filters.zone.toLowerCase());
                    const matchCode = center.code.includes(filters.code);
                    return matchName && matchZone && matchCode;
                });

                // 2. Ordenar
                return filtered.sort((a, b) => {
                    const aValue = a[sortConfig.key];
                    const bValue = b[sortConfig.key];

                    // Manejo específico para números o strings
                    if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
                    if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }, [filters, sortConfig]);

            const selectedIds = useMemo(() => new Set(selectedCenters.map(c => c.id)), [selectedCenters]);

            const handleAddCenter = (center) => {
                const MAX_CENTERS = 18;
                if (selectedCenters.length >= MAX_CENTERS) {
                    alert(`Has alcanzado el límite máximo de ${MAX_CENTERS} centros.`);
                    return;
                }
                if (selectedIds.has(center.id)) return;
                setSelectedCenters(prev => [...prev, center]);
            };

            const handleRemoveCenter = (id) => {
                setSelectedCenters(prev => prev.filter(c => c.id !== id));
            };

            const handleMoveCenter = (index, direction) => {
                if ((direction === 'up' && index === 0) || (direction === 'down' && index === selectedCenters.length - 1)) return;
                const newCenters = [...selectedCenters];
                const targetIndex = direction === 'up' ? index - 1 : index + 1;
                [newCenters[index], newCenters[targetIndex]] = [newCenters[targetIndex], newCenters[index]];
                setSelectedCenters(newCenters);
            };

            const handleExportExcel = async () => {
                let hasError = false;

                if (!teacherName.trim()) {
                    setNameError(true);
                    hasError = true;
                }

                if (!teacherDNI.trim()) {
                    setDniError(true);
                    hasError = true;
                }

                if (hasError) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    alert("Por favor, rellene todos los campos obligatorios del profesor.");
                    return;
                }

                if (selectedCenters.length === 0) {
                    alert("Selecciona al menos un centro.");
                    return;
                }

                const XLSX = window.XLSX;
                if (!XLSX) {
                    alert("Error: Librería Excel no cargada.");
                    return;
                }

                setIsUploading(true);

                try {
                    // 1. Generar los datos
                    const data = [
                        ["SOLICITUD DE CENTROS DE PRÁCTICAS"],
                        ["Fecha de exportación:", new Date().toLocaleDateString()],
                        [], 
                        ["Orden", "Nombre del Profesor", "DNI", "Estado Plaza", "Código Centro", "Nombre del Centro", "Zona", "Nº Estudiantes"] 
                    ];

                    selectedCenters.forEach((center, index) => {
                        data.push([
                            index + 1, 
                            teacherName, 
                            teacherDNI, 
                            center.status,
                            center.code, 
                            center.name, 
                            center.zone,
                            center.students
                        ]);
                    });

                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    ws['!cols'] = [
                        { wch: 8 }, { wch: 30 }, { wch: 15 }, { wch: 20 }, { wch: 15 }, { wch: 40 }, { wch: 20 }, { wch: 12 }
                    ];
                    
                    XLSX.utils.book_append_sheet(wb, ws, "Selección");
                    
                    // Generar nombre de archivo: nombre_fecha.xlsx
                    const safeName = teacherName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                    const dateObj = new Date();
                    const dateStr = dateObj.toISOString().split('T')[0]; // Formato YYYY-MM-DD
                    const fileName = `${safeName}_${dateStr}.xlsx`;

                    // 2. Si hay URL de script, enviar a Drive
                    if (GOOGLE_SCRIPT_URL) {
                        // Generar Base64
                        const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'base64' });
                        
                        // Enviar solicitud POST
                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: "POST",
                            body: JSON.stringify({
                                filename: fileName,
                                fileData: wbout,
                                mimeType: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                            })
                        });
                        
                        alert("✅ Archivo enviado correctamente a Google Drive.");
                    }

                    // 3. Descargar copia local (siempre útil como backup)
                    XLSX.writeFile(wb, fileName);

                } catch (error) {
                    console.error(error);
                    alert("Hubo un error al procesar el archivo. Se intentará descargar la copia local.");
                    try {
                        const wb = XLSX.utils.book_new(); // Reintentar generación local simple si falla el envío
                        // ... Lógica simplificada de fallback si fuera necesario, 
                        // pero normalmente el writeFile de arriba se ejecuta si el fetch falla y lo capturamos.
                    } catch (e) {}
                } finally {
                    setIsUploading(false);
                }
            };

            return (
                <div className="flex flex-col h-full bg-gray-50 font-sans">
                    <Header />
                    <main className="flex-1 overflow-hidden flex flex-col md:flex-row">
                        <div className="flex-1 flex flex-col min-w-0 h-full overflow-hidden">
                            <div className="p-6 h-full flex flex-col overflow-y-auto">
                                <TeacherForm 
                                    teacherName={teacherName} 
                                    setTeacherName={handleNameChange}
                                    teacherDNI={teacherDNI}
                                    setTeacherDNI={handleDNIChange}
                                    nameError={nameError}
                                    dniError={dniError}
                                />
                                <SearchFilters filters={filters} setFilters={setFilters} />
                                <CenterTable 
                                    centers={filteredCenters} 
                                    selectedIds={selectedIds} 
                                    onAdd={handleAddCenter} 
                                    sortConfig={sortConfig}
                                    onSort={handleSort}
                                />
                            </div>
                        </div>
                        <div className="w-full md:w-[350px] lg:w-[400px] shrink-0 h-full relative z-20">
                            <SelectedList 
                                selectedCenters={selectedCenters}
                                onRemove={handleRemoveCenter}
                                onMove={handleMoveCenter}
                                onExport={handleExportExcel}
                                isUploading={isUploading}
                            />
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>